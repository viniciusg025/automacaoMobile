"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.sendMemoryWarning = sendMemoryWarning;
exports.sendSignalToProcess = sendSignalToProcess;
exports.launchApp = launchApp;
const lodash_1 = __importDefault(require("lodash"));
/**
 * Simulates memory warning for the process with the given PID
 */
async function sendMemoryWarning(pid) {
    await this.execute(['device', 'process', 'sendMemoryWarning'], {
        subcommandOptions: ['--pid', `${pid}`],
    });
}
/**
 * Send POSIX signal to the running process
 */
async function sendSignalToProcess(pid, signal) {
    await this.execute(['device', 'process', 'signal'], {
        subcommandOptions: ['--signal', `${signal}`, '--pid', `${pid}`],
    });
}
/**
 * Launch the given bundle id application with the given environment variable.
 * This method is over devicectl command, this it may take additional seconds to launch the app.
 * Please use via WDA or via appium-ios-device as primary method to launch app if possible.
 */
async function launchApp(bundleId, opts = {}) {
    const { env, terminateExisting = false } = opts;
    const subcommandOptions = [];
    if (terminateExisting) {
        subcommandOptions.push('--terminate-existing');
    }
    if (!lodash_1.default.isEmpty(env)) {
        subcommandOptions.push('--environment-variables', JSON.stringify(lodash_1.default.mapValues(env, (v) => lodash_1.default.toString(v))));
    }
    // The bundle id should be the last to apply arguments properly.
    // devicectl command might not raise exception while the order is wrong.
    subcommandOptions.push(bundleId);
    await this.execute(['device', 'process', 'launch'], {
        subcommandOptions,
        asJson: false,
    });
}
//# sourceMappingURL=process.js.map